<div class="calendar-container">
  <!-- Calendar Header -->
  <mat-card class="calendar-header-card">
    <mat-card-content>
      <div class="calendar-header">
        <div class="navigation-section">
          <button mat-icon-button (click)="navigate('prev')" [attr.aria-label]="'Previous ' + currentView">
            <mat-icon>chevron_left</mat-icon>
          </button>
          
          <div class="current-period">
            <h2 class="period-title">{{ getViewTitle() }}</h2>
            <button mat-button class="today-btn" (click)="goToToday()" 
                    [class.highlighted]="isCurrentPeriodToday()">
              Today
            </button>
          </div>
          
          <button mat-icon-button (click)="navigate('next')" [attr.aria-label]="'Next ' + currentView">
            <mat-icon>chevron_right</mat-icon>
          </button>
        </div>

        <div class="view-controls">
          <mat-button-toggle-group [value]="currentView" (change)="onViewChange($event.value)" 
                                   class="view-toggle-group">
            <mat-button-toggle value="day">Day</mat-button-toggle>
            <mat-button-toggle value="week">Week</mat-button-toggle>
            <mat-button-toggle value="month">Month</mat-button-toggle>
          </mat-button-toggle-group>

          <button mat-raised-button color="primary" (click)="openAddLessonDialog()" class="add-lesson-btn">
            <mat-icon>add</mat-icon>
            Schedule Lesson
          </button>
        </div>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Calendar Content -->
  <div class="calendar-content">
    <!-- Month View -->
    @if (currentView() === 'month') {
      <mat-card class="month-view-card">
        <div class="month-view">
          <!-- Weekday Headers -->
          <div class="weekday-headers">
            @for (day of weekDays; track day) {
              <div class="weekday-header">{{ day }}</div>
            }
          </div>
          
          <!-- Calendar Grid -->
          <div class="month-grid">
            @for (week of getMonthWeeks(); track $index) {
              @for (day of week; track day.getTime()) {
                <div class="month-day" 
                     [class.other-month]="!isSameMonth(day)" 
                     [class.today]="isToday(day)"
                     [class.selected]="isSelected(day)"
                     (click)="onDayClick(day)">
                  <div class="day-number">{{ day.getDate() }}</div>
                  
                  <div class="day-lessons">
                    @for (lesson of getLessonsForDay(day); track lesson.id) {
                      <div class="lesson-dot" 
                           [style.background-color]="lesson.color || 'var(--mat-primary-500)'"
                           [matTooltip]="getLessonTooltip(lesson)"
                           (click)="onLessonClick(lesson, $event)">
                      </div>
                    }
                  </div>
                </div>
              }
            }
          </div>
        </div>
      </mat-card>
    }

    <!-- Week/Day View -->
    @if (currentView() === 'week' || currentView() === 'day') {
      <div class="week-day-container">
        <!-- Time Column -->
        <mat-card class="time-column-card">
          <div class="time-column">
            <div class="time-header">Time</div>
            @for (hour of getDisplayHours(); track hour) {
              <div class="time-slot-label">
                {{ formatHour(hour) }}
              </div>
            }
          </div>
        </mat-card>

        <!-- Days Grid -->
        <mat-card class="days-grid-card">
          <div class="days-container">
            <!-- Day Headers -->
            <div class="day-headers">
              @for (day of getVisibleDays(); track day.getTime()) {
                <div class="day-header" [class.today]="isToday(day)">
                  <div class="day-name">{{ day | date:'EEE' }}</div>
                  <div class="day-date" [class.today-date]="isToday(day)">{{ day | date:'d' }}</div>
                </div>
              }
            </div>

            <!-- Time Grid -->
            <div class="time-grid">
              @for (day of getVisibleDays(); track day.getTime()) {
                <div class="day-column">
                  @for (hour of getDisplayHours(); track hour) {
                    <div class="time-slot" 
                         (click)="onTimeSlotClick(day, hour)"
                         [class.current-hour]="isCurrentHour(day, hour)">
                    </div>
                  }
                </div>
              }
            </div>

            <!-- Lessons Overlay -->
            <div class="lessons-overlay">
              @for (lesson of getVisibleLessons(); track lesson.id) {
                <div class="lesson-block"
                     [style.top.px]="getLessonTop(lesson)"
                     [style.left.%]="getLessonLeft(lesson)"
                     [style.width.%]="getLessonWidth()"
                     [style.height.px]="getLessonHeight(lesson)"
                     [style.background-color]="lesson.color || 'var(--mat-primary-500)'"
                     [matTooltip]="getLessonTooltip(lesson)"
                     (click)="onLessonClick(lesson, $event)"
                     cdkDrag
                     [cdkDragBoundary]="'.time-grid'"
                     (cdkDragEnded)="onLessonDragEnd($event, lesson)">
                  
                  <div class="lesson-content">
                    <div class="lesson-title">{{ lesson.studentName }}</div>
                    <div class="lesson-time">{{ getLessonTimeString(lesson) }}</div>
                  </div>
                  
                  <div class="lesson-resize-handle" 
                       (mousedown)="startResize($event, lesson)">
                  </div>
                </div>
              }
            </div>
          </div>
        </mat-card>
      </div>
    }
  </div>

  <!-- Mini Calendar (optional, for quick navigation) -->
  <mat-card class="mini-calendar-card" *ngIf="currentView() !== 'month'">
    <mat-card-header>
      <mat-card-title>Quick Navigation</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <mat-calendar [selected]="selectedDate()" 
                    (selectedChange)="onMiniCalendarChange($event)"
                    [dateFilter]="dateFilter">
      </mat-calendar>
    </mat-card-content>
  </mat-card>
</div>